apiVersion: v1
kind: ConfigMap
metadata:
  name: olake-workers-config
  namespace: {{ include "olake.namespace" . }}
  annotations: {}
  labels:
    {{- include "olake.labels" . | nindent 4 }}
    app.kubernetes.io/component: workers
data:
  # Temporal Configuration
  TEMPORAL_ADDRESS: "temporal.{{ include "olake.namespace" . }}.svc.cluster.local:7233"
  
  # Kubernetes Configuration
  WORKER_NAMESPACE: {{ include "olake.namespace" . | quote }}
  OLAKE_STORAGE_PVC_NAME: {{ include "olake.sharedStoragePVC" . | quote }}
  CONTAINER_REGISTRY_BASE: {{ .Values.global.containerRegistryBase | quote }}
  KUBERNETES_IMAGE_PULL_SECRETS: {{ .Values.global.imagePullSecrets | toJson | quote }}

  # Logging Configuration
  LOG_LEVEL: {{ .Values.olakeWorker.config.logging.level | quote }}
  LOG_FORMAT: {{ .Values.olakeWorker.config.logging.format | quote }}
  
  # Runtime Configuration
  RUN_MODE: {{ .Values.olakeWorker.env.RUN_MODE | default .Values.global.env.RUN_MODE | default "staging" }}

  # API Callback
  OLAKE_CALLBACK_URL: "http://olake-ui.{{ include "olake.namespace" . }}.svc.cluster.local:8000/internal/worker/callback"
  # =================================================================
  # JOB MAPPING CONFIGURATION (Deprecated)
  # =================================================================
  {{- if .Values.global.jobMapping }}
  OLAKE_JOB_MAPPING: {{ .Values.global.jobMapping | toJson | quote }}
  {{- end }}

  # =================================================================
  # JOB PROFILES CONFIGURATION
  # =================================================================
  {{- if .Values.global.jobProfiles }}
  # Converted to JSON for consistent parsing by the worker
  OLAKE_JOB_PROFILES: {{ .Values.global.jobProfiles | toJson | quote }}
  {{- end }}
  
  # =================================================================
  # JOB SERVICE ACCOUNT CONFIGURATION
  # =================================================================
  JOB_SERVICE_ACCOUNT_NAME: {{ include "olake.jobServiceAccountName" . | quote }}